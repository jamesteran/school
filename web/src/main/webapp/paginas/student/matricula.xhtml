<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">

<body>

	<ui:composition template="#{layoutMB.template}">

		<ui:define name="title">
        	Matrícula del Estudiante
      	</ui:define>

		<ui:define name="head-end">
			<style type="text/css">
				.ui-grid-row .ui-grid-col-2, .ui-grid-row .ui-grid-col-10 {
					padding: 0.5em 0;
					margin-left: 10px;
					margin-top: 10px;
				}
				
				.ui-g-12, .ui-sm-12 {
					padding-left: 0;
					padding-right: 0;
				}
				
				.ui-datagrid-column .ui-panel.ui-widget-content {
					border: none;
				}
				
				.ui-grid-col-2 {
					padding: 0.8em 0.5em;
					margin-left: 10px;
				}
			</style>
		</ui:define>

		<ui:define name="body">
			<f:view>
				<h:form enctype="multipart/form-data" id="frmPrincipal" onkeypress="if (event.keyCode == 13) { return false; }">
					<p:panel id="all" class="ui-fluid" style="font-size: 8pt !important;">
						<p:growl showDetail="true" id="g" globalOnly="true" >
						 	<p:autoUpdate/>
                		</p:growl>
						
						<p:panel id="panelEstudiante" header="Informacion del estudiante" 
								styleClass="box box-primary">
							<h:panelGrid columns="2" cellspacing="7" style="width:100%;" 
								styleClass="ui-fluid card" columnClasses="ui-g-6,ui-g-6">
								
								<h:panelGrid columns="3" cellspacing="7" columnClasses="ui-g-3,ui-g-6,ui-g-3" styleClass="ui-fluid card" style="width:100%">
								
									<p:outputLabel value="Cedula :" />
									<p:inputText value="#{studentController.studentInfo.idNumber}" disabled="true"
										id="stdCed" required="true" requiredMessage="Ingrese la cédula" />
									<p:message for="stdCed" />
	
									<p:outputLabel value="Nombres:" />
									<p:inputText value="#{studentController.studentInfo.firstName}"
										id="stdNom" required="true"
										requiredMessage="Ingrese los nombres" />
									<p:message for="stdNom" />
	
									<p:outputLabel value="Apellidos:" />
									<p:inputText value="#{studentController.studentInfo.lastName}"
										id="stdApe" required="true"
										requiredMessage="Ingrese los apellidos" />
									<p:message for="stdApe" />
	
									<p:outputLabel value="Lugar Nacimiento:" />
									<p:inputText
										value="#{studentController.studentInfo.stdBirthPlace}"
										id="stdBp" required="true"
										requiredMessage="Ingrese lugar nacimiento" />
									<p:message for="stdBp" />
	
									<p:outputLabel value="Fecha Nacimiento:" />
									<p:calendar value="#{studentController.studentInfo.stdDob}"
										id="dob" required="true"
										requiredMessage="Ingrese fecha nacimiento" locale="es_ES"
										pattern="dd/MM/yyyy" />
									<p:message for="dob" />
	
									<p:outputLabel value="Edad:" />
									<p:inputText value="#{studentController.studentInfo.stdAge}"
										id="stdAge" required="true" requiredMessage="Ingrese la edad" validatorMessage="Solo números">
									</p:inputText>
									<p:keyFilter mask="int" for="stdAge"/>
									<p:message for="stdAge" />
	
									<p:outputLabel value="Nacionalidad:" />
									<p:inputText value="#{studentController.studentInfo.stdNac}"
										id="stdNac" required="true"
										requiredMessage="Ingrese la nacionalidad" />
									<p:message for="stdNac" />
									
									<p:outputLabel value="Genero: " />
									<p:selectOneMenu
										value="#{studentController.studentInfo.stdGender}"
										style="width: 130px;" id="genStd" required="true"
										requiredMessage="Seleccione el género">>
		                				<f:selectItem itemLabel="#{msg['mensaje.seleccione']}"
											itemValue="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{studentController.genero}" var="gen"
											itemLabel="#{gen.descripcion}" itemValue="#{gen.codigo}" />
									</p:selectOneMenu>
									<p:message for="genStd" />
									
									<p:outputLabel value="Grupo sanguíneo: " />
									<p:selectOneMenu
										value="#{studentController.studentInfo.stdBloodGrp}"
										style="width: 130px;" id="bloodStd" required="true"
										requiredMessage="Seleccione el género">>
		                				<f:selectItem itemLabel="#{msg['mensaje.seleccione']}"
											itemValue="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{studentController.bloodGrp}" var="bg"
											itemLabel="#{bg.descripcion}" itemValue="#{bg.codigo}" />
									</p:selectOneMenu>
									<p:message for="bloodStd" />
									
									<p:outputLabel value="Nº hermanos (incluye alumno):" />
									<p:inputText value="#{studentController.studentInfo.stdSiblings}"
										id="stdHermanos" required="true"
										requiredMessage="Campo Requerido" />
									<p:message for="stdHermanos" />
									
									<p:outputLabel value="Vive con:" />
									<p:inputText value="#{studentController.studentInfo.stdViveCon}"
										id="stdVivecon" required="true"
										requiredMessage="Campo Requerido" />
									<p:message for="stdVivecon" />
	
									<p:outputLabel value="Dirección:" />
									<p:inputText value="#{studentController.studentInfo.stdDir}"
										id="stdDir" required="true"
										requiredMessage="Ingrese la dirección" />
									<p:message for="stdDir" />
									
									<p:outputLabel value="Parroquia: " />
									<p:selectOneMenu
										value="#{studentController.studentInfo.parroquia.parroquiaId}"
										style="width: 130px;" id="parrStudent" required="true"
										requiredMessage="Seleccione la parroquia">
										<f:selectItem itemLabel="#{msg['mensaje.seleccione']}"
											itemValue="#{null}" noSelectionOption="true" />
										<f:selectItems value="#{studentController.parroquias}"
											var="par" itemLabel="#{par.parroquiaName}"
											itemValue="#{par.parroquiaId}" />
									</p:selectOneMenu>
									<p:message for="parrStudent" />
																		
								</h:panelGrid>
								
								<h:panelGrid columns="3" cellspacing="7" columnClasses="ui-g-3,ui-g-6,ui-g-3" styleClass="ui-fluid card" style="width:100%">
											
									<p:outputLabel value="Foto:" />
									<img
										src="data:image/png;base64, #{studentController.studentPic}"
										alt="" style="border: 10px ridge #c2dfef;" width="120"
										height="130" />
									<p:outputLabel value="" />
	
									<p:outputLabel value="" />
									<p:fileUpload value="#{studentController.studentPhoto}"
										mode="advanced" id="fotoStudent" update=":frmPrincipal"
										auto="true" style="width: 120px;" invalidFileMessage="Solo jpg y png"
										allowTypes="/(\.|\/)(gif|jpe?g|png)$/" 
										fileUploadListener="#{studentController.changeStudentPhoto}"
										label="Escoger"
										sizeLimit="100000" invalidSizeMessage="Máximo 1MB"/>
									<p:message for="fotoStudent" />
								
									<p:outputLabel value="Teléfono:" />
									<p:inputText value="#{studentController.studentInfo.stdPhone}"
										id="stdTel" required="true"  validatorMessage="Solo números"
										requiredMessage="Ingrese el teléfono" onblur="">
										<f:validateRegex pattern="[0-9]+" />
									</p:inputText>
									<p:message for="stdTel" />
	
									<p:outputLabel value="Celular:" />
									<p:inputText value="#{studentController.studentInfo.stdMobil}"
										id="stdCel" required="true" requiredMessage="Ingrese el celular"
										validatorMessage="Solo números">
										<f:validateRegex pattern="[0-9]+" />
									</p:inputText>
									<p:message for="stdCel" />
	
									<p:outputLabel value="Referencia domiciliaria:" />
									<p:inputText value="#{studentController.studentInfo.stdDirRef}"
										id="stdRef" required="true" requiredMessage="Ingrese refrencia" />
									<p:message for="stdRef" />
	
									<p:outputLabel value="Zona:" />
									<p:inputText value="#{studentController.studentInfo.stdZona}"
										id="stdZon" required="true" requiredMessage="Ingrese la zona" />
									<p:message for="stdZon" />
	
									<p:outputLabel value="Sector:" />
									<p:inputText value="#{studentController.studentInfo.stdSector}"
										id="stdSect" required="true"
										requiredMessage="Ingrese el sector" />
									<p:message for="stdSect" />
	
									<p:outputLabel value="Color del domicilio:" />
									<p:inputText value="#{studentController.studentInfo.stdColorCasa}"
										id="stdColCasa" required="true"
										requiredMessage="Campo Requerido" />
									<p:message for="stdColCasa" />
									
									<p:outputLabel value="Nº pisos domicilio:" />
									<p:inputText value="#{studentController.studentInfo.stdPisoCasa}"
										id="stdPiso" required="true"
										requiredMessage="Campo Requerido" />
									<p:message for="stdPiso" />
									
																		
								</h:panelGrid>			
							</h:panelGrid>
						</p:panel>
						<br />
						<br />

						
							<p:panel id="panelPrents" header="Información de los padres"
								styleClass="box box-primary">
								<p:outputLabel value="Por favor complete la información de los padres haciendo clik en Editar."/>
								<h:panelGrid columns="1" style="margin: 0 auto;"
									columnClasses="ui-grid-col-2">
									<p:commandButton value="Agregar" update=":popupParent" disabled="#{(studentController.parents.size() == 2)}"
										styleClass="btn-primary pull left" immediate="true"
										oncomplete="PF('varParent').show()" icon="ui-icon-extlink"
										action="#{studentController.newParent()}" />
								</h:panelGrid>
								<p:dataTable id="tblParent" value="#{studentController.parents}"
									var="rep" widgetVar="reptable" style="font-size: 9pt;"
									class="table table-bordered" reflow="true">
									<p:column headerText="Cedula">
										<h:outputText value="#{rep.idNumber}" />
									</p:column>
									<p:column headerText="Nombres">
										<h:outputText value="#{rep.firstName}" />
									</p:column>
									<p:column headerText="Apellidos">
										<h:outputText value="#{rep.lastName}" />
									</p:column>
									<p:column headerText="Tipo">
										<h:outputText value="#{rep.parentType.prntypeName}" />
									</p:column>
									<p:column headerText="Opción"
										style="text-align: center; width:250px;">
										<p:commandButton value="Editar" style="width:100px;"
											action="#{studentController.editParent}"
											oncomplete="PF('varParent').show()" update=":popupParent"
											immediate="true" icon="ui-icon-pencil"
											styleClass="btn-success">
											<f:setPropertyActionListener
												target="#{studentController.parentPha}" value="#{rep}" />
										</p:commandButton>
										<p:commandButton value="Eliminar"
											action="#{studentController.deleteParent}"
											icon="ui-icon-close" styleClass="btn-danger" immediate="true"
											update="tblParent" style="width:100px;">
											<f:setPropertyActionListener
												target="#{studentController.parentPha}" value="#{rep}" />
										</p:commandButton>
									</p:column>
								</p:dataTable>
							</p:panel>
						<br />

						<p:panel id="panelPerRetirar" header="Personas autorizadas a retirar al alumno"
							styleClass="box box-primary">
							
								<h:panelGrid columns="1" style="margin: 0 auto;"
									columnClasses="ui-grid-col-2">
									<p:commandButton value="Agregar" update=":popupRepresentante"
										styleClass="btn-primary pull left" immediate="true"
										oncomplete="PF('varRepresentante').show()"
										icon="ui-icon-extlink" action="#{studentController.newRepresentante()}" />
								</h:panelGrid>
								<p:dataTable id="tblRepresentante"
									value="#{studentController.representantes}" var="rep"
									widgetVar="reptable" style="font-size: 9pt;"
									class="table table-bordered" reflow="true">
									<p:column headerText="Cedula">
										<h:outputText value="#{rep.idNumber}" />
									</p:column>
									<p:column headerText="Nombres">
										<h:outputText value="#{rep.firstName}" />
									</p:column>
									<p:column headerText="Apellidos">
										<h:outputText value="#{rep.lastName}" />
									</p:column>
									<p:column headerText="Opción"
										style="text-align: center; width:250px;">
										<p:commandButton value="Editar" style="width:100px;"
											action="#{studentController.editCustodian()}"
											oncomplete="PF('varRepresentante').show()" update=":popupRepresentante"
											immediate="true" icon="ui-icon-pencil"
											styleClass="btn-success">
											<f:setPropertyActionListener
												target="#{studentController.representante}" value="#{rep}" />
										</p:commandButton>
										<p:commandButton value="Eliminar"
											action="#{studentController.deleteCustodian()}"
											icon="ui-icon-close" styleClass="btn-danger" immediate="true"
											update="tblRepresentante" style="width:100px;">
											<f:setPropertyActionListener
												target="#{studentController.representante}" value="#{rep}" />
										</p:commandButton>
									</p:column>
								</p:dataTable>
						</p:panel>

						<p:panel id="panelEnv" header="Datos para la facturación"
							styleClass="box box-primary">
							<h:panelGrid columns="3" cellspacing="7"
								columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2"
								style="ui-fluid card">
								<p:outputLabel value="Cedula/RUC:" />
								<p:inputText value="#{studentController.envoice.envcliRuc}"
									id="envRuc" required="true" requiredMessage="Ingrese Ced/RUC" />
								<p:message for="envRuc" />

								<p:outputLabel value="Razón Social:" />
								<p:inputText
									value="#{studentController.envoice.envcliRazonSocial}"
									id="envName" required="true"
									requiredMessage="Ingrese razón social" />
								<p:message for="envName" />

								<p:outputLabel value="Dirección" />
								<p:inputText value="#{studentController.envoice.envcliAddr}"
									id="envDir" required="true"
									requiredMessage="Ingrese la dirección" />
								<p:message for="envDir" />

								<p:outputLabel value="Teléfono:" />
								<p:inputText value="#{studentController.envoice.envcliPhone}"
									id="envTel" required="true"
									requiredMessage="Ingrese el teléfono" />
								<p:message for="envTel" />

								<p:outputLabel value="Celular:" />
								<p:inputText value="#{studentController.envoice.envcliMobil}"
									id="envCel" required="true"
									requiredMessage="Ingrese el celular" />
								<p:message for="envCel" />

								<p:outputLabel value="Email:" />
								<p:inputText value="#{studentController.envoice.envcliEmail}"
									id="envEmail" required="true" requiredMessage="Ingrese email" validatorMessage="Ingrese email válido">
									<f:validateRegex
										pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
								</p:inputText>
								<p:message for="envEmail" />
							</h:panelGrid>
						</p:panel>


						<p:panel id="panelTransport" header="Datos para el transporte"
							styleClass="box box-primary">
							<p:outputLabel value="Por favor ingrese marque la casilla si va contratar el transporte escolar."/>
							
							<br />							
							<br />
							<p:selectBooleanCheckbox
								value="#{studentController.transport.needTrans}"
								itemLabel="Transporte escolar">
								<p:ajax update="panelTransport" />
							</p:selectBooleanCheckbox>
							<h:panelGrid columns="1" cellspacing="7" style="width: 100%"
								rendered="#{studentController.transport.needTrans}">

								<h:panelGrid columns="2"
									style="margin-bottom:10px; width: 100%;" cellpadding="5"
									columnClasses="ui-grid-col-2,ui-grid-col-6">
									<p:selectBooleanCheckbox
										value="#{studentController.morningTransport}"
										itemLabel="Transporte por la mañana">
										<p:ajax update="panelTransport" />
									</p:selectBooleanCheckbox>

									<h:panelGrid columns="3" cellpadding="5"
										rendered="#{studentController.morningTransport}"
										columnClasses="ui-grid-col-2,ui-grid-col-6,ui-grid-col-2"
										style="ui-fluid card">
										<p:outputLabel value="Dirección por la mañana:" />
										<p:inputText value="#{studentController.transport.pupAddrMorn}"
											id="dirTranportMorning" required="true"
											requiredMessage="Ingrese la dirección" />
										<p:message for="dirTranportMorning" />
									</h:panelGrid>
								</h:panelGrid>

								<h:panelGrid columns="2"
									style="margin-bottom:10px; width: 100%;" cellpadding="5"
									columnClasses="ui-grid-col-2,ui-grid-col-6">
									<p:selectBooleanCheckbox
										value="#{studentController.noonTransport}"
										itemLabel="Transporte por la tarde">
										<p:ajax update="panelTransport" />
									</p:selectBooleanCheckbox>

									<h:panelGrid columns="3" cellpadding="5"
										rendered="#{studentController.noonTransport}"
										columnClasses="ui-grid-col-2,ui-grid-col-6,ui-grid-col-2"
										style="ui-fluid card">
										<p:outputLabel value="Dirección por tarde:" />
										<p:inputText
											value="#{studentController.transport.pupAddrNoon}"
											id="dirTranportNoon" required="true"
											requiredMessage="Ingrese la dirección" />
										<p:message for="dirTranportNoon" />
									</h:panelGrid>
								</h:panelGrid>

							</h:panelGrid>
						</p:panel>

						<p:panel id="panelFichaMedica" header="Datos médicos"
							styleClass="box box-primary">
							<p:outputLabel value="Por favor ingrese su respuesta, haciendo clic en frente  de cada pregunta se presentará el espacio para ser llenado"/>
							<p:dataTable id="tblFichaMedica" var="car"
								value="#{studentController.medicalAnswers}" editable="true"
								rowIndexVar="it"
								onrowmouseover="this.style.backgroundColor='#FFFFE0'"
								onrowmouseout="this.style.backgroundColor='#F7FDFC'"
								editMode="cell" widgetVar="cellCars">
								<p:ajax event="cellEdit"
									listener="#{studentController.onAnswerEdit}" />
								<p:column style="width:3%">
									<f:facet name="header">#</f:facet>
				                	#{it+1}
				            	</p:column>
								<p:column headerText="Pregunta">
									<h:outputText value="#{car.schMedicalQuiz.quizQuestion}" />
								</p:column>
	
								<p:column headerText="Respuesta" >
									<p:cellEditor>
										<f:facet name="output">
											<h:outputText value="#{car.quizAnswer}" />
											
										</f:facet>
										<f:facet name="input">
											<p:inputText value="#{car.quizAnswer}" style="width:96%" id="txtQuizAnswer" />
											<p:watermark for="txtQuizAnswer" value="Ingrese su respuesta" id="watermark" />
										</f:facet>
									</p:cellEditor>
								</p:column>
	
							</p:dataTable>
						</p:panel>
						
						<p:panel id="panelMatricula" header="Datos académicos" styleClass="box box-primary">	
							<p:panelGrid columns="2" style="margin-bottom:10px; width: 100%;" cellpadding="5"
								columnClasses="ui-grid-col-2,ui-grid-col-6">
								
								<p:outputLabel value="Matrícula anterior:" />
								<p:panelGrid columns="2" cellpadding="5" 
									columnClasses="ui-grid-col-2,ui-grid-col-6" styleClass="ui-fluid card">
									<p:outputLabel value="Año lectivo:" />
									<p:inputText value="#{studentController.matriculaActual.academicYear.acyear}" disabled="true" />
									<p:outputLabel value="Curso:" />
									<p:inputText value="#{studentController.matriculaActual.sectionName.className.className}" disabled="true" />
									<p:outputLabel value="Paralelo:" />
									<p:inputText value="#{studentController.matriculaActual.sectionName.sectionName}" disabled="true" />
								</p:panelGrid>
								
								<p:outputLabel value="Matrícula actual:" />
								<p:panelGrid columns="2" cellpadding="5" 
									columnClasses="ui-grid-col-2,ui-grid-col-6" styleClass="ui-fluid card">
									<p:outputLabel value="Año lectivo:" />
									<p:inputText value="#{studentController.matriculaProxima.academicYear.acyear}" disabled="true" />
									<p:outputLabel value="Curso:" />
									<p:inputText value="#{studentController.matriculaProxima.sectionName.className.className}" disabled="true" />
									<p:outputLabel value="Paralelo:" />
									<p:outputLabel value="El parelelo será asignado posteriormente."  />
								</p:panelGrid>
								
							</p:panelGrid>
						</p:panel>

						<h:panelGrid columns="1" style="margin: 0 auto;">
							<p:commandButton value="Guardar Información" styleClass="btn-primary"
								action="#{studentController.guardarEstudiante()}" update="all,g"
								ajax="false" />
						</h:panelGrid>
					</p:panel>
				</h:form>
			</f:view>
			<ui:include src="/public/popup/contactoPoup.xhtml" />
			<ui:include src="/public/popup/parentDialog.xhtml" />
		</ui:define>
	</ui:composition>
</body>
</html>

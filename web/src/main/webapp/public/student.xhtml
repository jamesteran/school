<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:f="http://java.sun.com/jsf/core">

<body>

	<ui:composition template="#{layoutMB.template}">

		<ui:define name="title">
        	Matrícula del Estudiante
      	</ui:define>

		<ui:define name="head-end">
			<style type="text/css">
				.ui-grid-row .ui-grid-col-2, .ui-grid-row .ui-grid-col-10 {
					padding: 0.5em 0;
					margin-left: 10px;
					margin-top: 10px;
				}
				
				.ui-g-12, .ui-sm-12 {
					padding-left: 0;
					padding-right: 0;
				}
				
				.ui-datagrid-column .ui-panel.ui-widget-content {
					border: none;
				}
				
				.ui-grid-col-2 {
					padding: 0.8em 0.5em;
					margin-left: 10px;
				}
			</style>
		</ui:define>

		<ui:define name="body">
			<f:view>
				<h:form enctype="multipart/form-data" id="frmPrincipal">
					<p:panel id="all" class="ui-fluid">
						<p:growl showDetail="true" id="g" globalOnly="true" />
						<p:fieldset legend="Informacion del estudiante">
							<h:panelGrid columns="3" cellspacing="7"
								columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2"
								style="ui-fluid card">


								<p:outputLabel value="Cedula :" />
								<p:inputText value="#{studentController.studentInfo.idNumber}"
									id="stdCed" required="true" requiredMessage="Ingrese la cédula" />
								<p:message for="stdCed" />

								<p:outputLabel value="Nombres:" />
								<p:inputText value="#{studentController.studentInfo.firstName}"
									id="stdNom" required="true"
									requiredMessage="Ingrese los nombres" />
								<p:message for="stdNom" />

								<p:outputLabel value="Apellidos:" />
								<p:inputText value="#{studentController.studentInfo.lastName}"
									id="stdApe" required="true"
									requiredMessage="Ingrese los apellidos" />
								<p:message for="stdApe" />

								<p:outputLabel value="Lugar Nacimiento:" />
								<p:inputText
									value="#{studentController.studentInfo.stdBirthPlace}"
									id="stdBp" required="true"
									requiredMessage="Ingrese lugar nacimiento" />
								<p:message for="stdBp" />

								<p:outputLabel value="Fecha Nacimiento:" />
								<p:calendar value="#{studentController.studentInfo.stdDob}"
									id="dob" required="true"
									requiredMessage="Ingrese fecha nacimiento" locale="es_ES"
									pattern="dd/MM/yyyy" />
								<p:message for="dob" />

								<p:outputLabel value="Edad:" />
								<p:inputText value="#{studentController.studentInfo.stdAge}"
									id="stdAge" required="true" requiredMessage="Ingrese la edad" />
								<p:message for="stdAge" />

								<p:outputLabel value="Nacionalidad:" />
								<p:inputText value="#{studentController.studentInfo.stdNac}"
									id="stdNac" required="true"
									requiredMessage="Ingrese la nacionalidad" />
								<p:message for="stdNac" />

								<p:outputLabel value="Dirección:" />
								<p:inputText value="#{studentController.studentInfo.stdDir}"
									id="stdDir" required="true"
									requiredMessage="Ingrese la dirección" />
								<p:message for="stdDir" />

								<p:outputLabel value="Teléfono:" />
								<p:inputText value="#{studentController.studentInfo.stdPhone}"
									id="stdTel" required="true"
									requiredMessage="Ingrese el teléfono">
									<f:validateRegex pattern="[0-9]{9}" />
								</p:inputText>
								<p:message for="stdTel" />

								<p:outputLabel value="Celular:" />
								<p:inputText value="#{studentController.studentInfo.stdMobil}"
									id="stdCel" required="true"
									requiredMessage="Ingrese el celular">
									<f:validateRegex pattern="[0-9]{10}" />
								</p:inputText>
								<p:message for="stdCel" />

								<p:outputLabel value="Referencia:" />
								<p:inputText value="#{studentController.studentInfo.stdDirRef}"
									id="stdRef" required="true" requiredMessage="Ingrese refrencia" />
								<p:message for="stdRef" />

								<p:outputLabel value="Zona:" />
								<p:inputText value="#{studentController.studentInfo.stdZona}"
									id="stdZon" required="true" requiredMessage="Ingrese la zona" />
								<p:message for="stdZon" />

								<p:outputLabel value="Sector:" />
								<p:inputText value="#{studentController.studentInfo.stdSector}"
									id="stdSect" required="true"
									requiredMessage="Ingrese el sector" />
								<p:message for="stdSect" />

								<p:outputLabel value="Parroquia a la que pertenece: " />
								<p:selectOneMenu
									value="#{studentController.studentInfo.parroquia.parroquiaId}"
									style="width: 130px;" id="parrStudent" required="true"
									requiredMessage="Seleccione la parroquia">
									<f:selectItem itemLabel="#{msg['mensaje.seleccione']}"
										itemValue="#{null}" noSelectionOption="true" />
									<f:selectItems value="#{studentController.parroquias}"
										var="par" itemLabel="#{par.parroquiaName}"
										itemValue="#{par.parroquiaId}" />
								</p:selectOneMenu>
								<p:message for="parrStudent" />

								<p:outputLabel value="Genero: " />
								<p:selectOneMenu
									value="#{studentController.studentInfo.stdGender}"
									style="width: 130px;" id="genStd" required="true"
									requiredMessage="Seleccione el género">>
	                				<f:selectItem itemLabel="#{msg['mensaje.seleccione']}"
										itemValue="#{null}" noSelectionOption="true" />
									<f:selectItems value="#{studentController.genero}" var="gen"
										itemLabel="#{gen.descripcion}" itemValue="#{gen.codigo}" />
								</p:selectOneMenu>
								<p:message for="genStd" />

								<p:outputLabel value="Foto:" />
								<p:fileUpload value="#{studentController.studentPhoto}"
									mode="advanced" id="fotoStudent" update=":frmPrincipal"
									auto="true" style="width: 120px;"
									allowTypes="/(\.|\/)(gif|jpe?g|png)$/" required="true"
									fileUploadListener="#{studentController.changeStudentPhoto}"
									requiredMessage="Please select photo" label="Escoger"
									sizeLimit="100000" />
								<p:message for="fotoStudent" />

								<p:outputLabel value="" />
								<!-- <p:graphicImage id="imgStudent" value="data:image/jpg;base64,#{studentController.studentPic}" cache="false" 
               					  width="120" height="130" style="border: 10px ridge #c2dfef;" />    -->

								<img
									src="data:image/png;base64, #{studentController.studentPic}"
									alt="Red dot" style="border: 10px ridge #c2dfef;" width="120"
									height="130" />


							</h:panelGrid>
						</p:fieldset>
						<br />


						<br />

						<p:fieldset legend="Informacion de los padres">
							<p:panel id="panelPrents" header="Información de los padres"
								styleClass="box box-primary">
								<h:panelGrid columns="1" style="margin: 0 auto;"
									columnClasses="ui-grid-col-2">
									<p:commandButton value="Agregar" update=":popupParent"
										styleClass="btn-primary pull left" immediate="true"
										oncomplete="PF('varParent').show()" icon="ui-icon-extlink"
										action="#{studentController.newParent()}" />
								</h:panelGrid>
								<p:dataTable id="tblParent" value="#{studentController.parents}"
									var="rep" widgetVar="reptable" style="font-size: 9pt;"
									class="table table-bordered" reflow="true">
									<p:column headerText="Cedula">
										<h:outputText value="#{rep.idNumber}" />
									</p:column>
									<p:column headerText="Nombres">
										<h:outputText value="#{rep.firstName}" />
									</p:column>
									<p:column headerText="Apellidos">
										<h:outputText value="#{rep.lastName}" />
									</p:column>
									<p:column headerText="Tipo">
										<h:outputText value="#{rep.parentType.prntypeName}" />
									</p:column>
									<p:column headerText="Opción"
										style="text-align: center; width:250px;">
										<p:commandButton value="Editar" style="width:100px;"
											action="#{studentController.editParent}"
											oncomplete="PF('varParent').show()" update=":popupParent"
											immediate="true" icon="ui-icon-pencil"
											styleClass="btn-success">
											<f:setPropertyActionListener
												target="#{studentController.parentPha}" value="#{rep}" />
										</p:commandButton>
										<p:commandButton value="Eliminar"
											action="#{studentController.deleteParent}"
											icon="ui-icon-close" styleClass="btn-danger" immediate="true"
											update="tblParent" style="width:100px;">
											<f:setPropertyActionListener
												target="#{studentController.parentPha}" value="#{rep}" />
										</p:commandButton>
									</p:column>
								</p:dataTable>
							</p:panel>
						</p:fieldset>
						<br />

						<p:fieldset legend="Representante Legal">
							<div class="box box-primary">
								<div class="box-header">
									<h3 class="box-title">Personas autorizadas a retirar al alumno</h3>
								</div>
								<div class="box-body">
									<h:panelGrid columns="1" style="margin: 0 auto;"
										columnClasses="ui-grid-col-2">
										<p:commandButton value="Agregar" update=":popupRepresentante"
											styleClass="btn-primary pull left"
											oncomplete="PF('varRepresentante').show()"
											icon="ui-icon-extlink" />
									</h:panelGrid>
									<p:dataTable id="tblRepresentante"
										value="#{studentController.representantes}" var="rep"
										widgetVar="reptable" style="font-size: 9pt;"
										class="table table-bordered" reflow="true">
										<p:column headerText="Cedula">
											<h:outputText value="#{rep.idNumber}" />
										</p:column>
										<p:column headerText="Nombres">
											<h:outputText value="#{rep.firstName}" />
										</p:column>
										<p:column headerText="Apellidos">
											<h:outputText value="#{rep.lastName}" />
										</p:column>
									</p:dataTable>
								</div>
							</div>
						</p:fieldset>

						<p:panel id="panelEnv" header="Datos para la facturación"
							styleClass="box box-primary">
							<h:panelGrid columns="3" cellspacing="7"
								columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-2"
								style="ui-fluid card">
								<p:outputLabel value="Cedula/RUC:" />
								<p:inputText value="#{studentController.envoice.envcliRuc}"
									id="envRuc" required="true" requiredMessage="Ingrese Ced/RUC" />
								<p:message for="envRuc" />

								<p:outputLabel value="Razón Social:" />
								<p:inputText
									value="#{studentController.envoice.envcliRazonSocial}"
									id="envName" required="true"
									requiredMessage="Ingrese razón social" />
								<p:message for="envName" />

								<p:outputLabel value="Dirección" />
								<p:inputText value="#{studentController.envoice.envcliAddr}"
									id="envDir" required="true"
									requiredMessage="Ingrese la dirección" />
								<p:message for="envDir" />

								<p:outputLabel value="Teléfono:" />
								<p:inputText value="#{studentController.envoice.envcliPhone}"
									id="envTel" required="true"
									requiredMessage="Ingrese el teléfono" />
								<p:message for="envTel" />

								<p:outputLabel value="Celular:" />
								<p:inputText value="#{studentController.envoice.envcliMobil}"
									id="envCel" required="true"
									requiredMessage="Ingrese el celular" />
								<p:message for="envCel" />

								<p:outputLabel value="Email:" />
								<p:inputText value="#{studentController.envoice.envcliEmail}"
									id="envEmail" required="true" requiredMessage="Ingrese email">
									<f:validateRegex
										pattern="^[_A-Za-z0-9-\+]+(\.[_A-Za-z0-9-]+)*@[A-Za-z0-9-]+(\.[A-Za-z0-9]+)*(\.[A-Za-z]{2,})$" />
								</p:inputText>
								<p:message for="envEmail" />
							</h:panelGrid>
						</p:panel>


						<p:panel id="panelTransport" header="Datos para el transporte"
							styleClass="box box-primary">
							<p:selectBooleanCheckbox
								value="#{studentController.needTransport}"
								itemLabel="Transporte escolar">
								<p:ajax update="panelTransport" />
							</p:selectBooleanCheckbox>
							<h:panelGrid columns="1" cellspacing="7" style="width: 100%"
								rendered="#{studentController.needTransport}">

								<h:panelGrid columns="2"
									style="margin-bottom:10px; width: 100%;" cellpadding="5"
									columnClasses="ui-grid-col-2,ui-grid-col-6">
									<p:selectBooleanCheckbox
										value="#{studentController.morningTransport}"
										itemLabel="Transporte por la mañana">
										<p:ajax update="panelTransport" />
									</p:selectBooleanCheckbox>

									<h:panelGrid columns="3" cellpadding="5"
										rendered="#{studentController.morningTransport}"
										columnClasses="ui-grid-col-2,ui-grid-col-6,ui-grid-col-2"
										style="ui-fluid card">
										<p:outputLabel value="Dirección por la mañana:" />
										<p:inputText value="#{studentController.envoice.envcliRuc}"
											id="dirTranportMorning" required="true"
											requiredMessage="Ingrese la dirección" />
										<p:message for="dirTranportMorning" />
									</h:panelGrid>
								</h:panelGrid>

								<h:panelGrid columns="2"
									style="margin-bottom:10px; width: 100%;" cellpadding="5"
									columnClasses="ui-grid-col-2,ui-grid-col-6">
									<p:selectBooleanCheckbox
										value="#{studentController.noonTransport}"
										itemLabel="Transporte por la tarde">
										<p:ajax update="panelTransport" />
									</p:selectBooleanCheckbox>

									<h:panelGrid columns="3" cellpadding="5"
										rendered="#{studentController.noonTransport}"
										columnClasses="ui-grid-col-2,ui-grid-col-6,ui-grid-col-2"
										style="ui-fluid card">
										<p:outputLabel value="Dirección por tarde:" />
										<p:inputText
											value="#{studentController.envoice.envcliRazonSocial}"
											id="dirTranportNoon" required="true"
											requiredMessage="Ingrese la dirección" />
										<p:message for="dirTranportNoon" />
									</h:panelGrid>
								</h:panelGrid>

							</h:panelGrid>
						</p:panel>


						<p:dataTable id="tblFichaMedica" var="car"
							value="#{studentController.medicalAnswers}" editable="true"
							editMode="cell" widgetVar="cellCars">
							<f:facet name="header"> Ficha médica</f:facet>
							<p:ajax event="cellEdit"
								listener="#{studentController.onAnswerEdit}" />
							<p:column headerText="Pregunta">
								<h:outputText value="#{car.schMedicalQuiz.quizQuestion}" />
							</p:column>

							<p:column headerText="Respuesta">
								<p:cellEditor>
									<f:facet name="output">
										<h:outputText value="#{car.quizAnswer}" />
									</f:facet>
									<f:facet name="input">
										<p:inputText value="#{car.quizAnswer}" style="width:96%"
											id="txtQuizAnswer" />
									</f:facet>
								</p:cellEditor>
							</p:column>

						</p:dataTable>
						
						<!-- 
              <p:fieldset legend="Hermanos que estudian en la institucion">
                <div class="box box-primary">
					<div class="box-header">
						<h3 class="box-title">Hermanos</h3>
					</div>
					<div class="box-body">
						<h:panelGrid columns="1" style="margin: 0 auto;" columnClasses="ui-grid-col-2">
			                <p:commandButton value="Agregar" update=":popupHermano" styleClass="btn-primary pull left"
								oncomplete="PF('varHermano').show()" icon="ui-icon-extlink"/>
		              	</h:panelGrid>
						<p:dataTable id="tblHermanos" value="#{studentController.hermanos}"
							var="herm" widgetVar="hermtable" style="font-size: 9pt;"
							class="table table-bordered" reflow="true">
							<p:column headerText="Cedula">
			                	<h:outputText value="#{herm.schUser.idNumber}"/>
			              	</p:column>
							<p:column headerText="Nombres" >
			                	<h:outputText value="#{herm.schUser.firstName}"/>
			              	</p:column>
							<p:column headerText="Apellidos" >
			                	<h:outputText value="#{herm.schUser.phaLastName}"/>
			              	</p:column>
						</p:dataTable>
					</div>
				</div>
              </p:fieldset>-->




						<!-- <p:fieldset legend="Academic Information">
                <h:panelGrid columns="3" columnClasses="firstcolumn,centercolumn,thirdcolumn" cellpadding="7" style="margin: 0 auto;">
                  <p:outputLabel value="Academic Year :" />
                  <p:selectOneMenu id="acy" value="#{newStudentBean.academicYearId}" required="true" requiredMessage="Please select academic year" style="width: 145px">
                    <f:selectItem itemLabel="Select" itemValue=""/>
                    <f:selectItems value="#{newStudentBean.allAcademicYear}" var="acyy" itemLabel="#{acyy.academicYear}" itemValue="#{acyy.academicYearId}"/>                           
                    <p:ajax event="change" update="secc"/>
                  </p:selectOneMenu>
                  <p:message for="acy"/>

                  <p:outputLabel value="Class Name :" />
                  <p:selectOneMenu id="clas" value="#{newStudentBean.classId}" required="true" requiredMessage="Please select class" style="width: 145px">
                    <f:selectItem itemLabel="Select" itemValue=""/>
                    <f:selectItems value="#{newStudentBean.allClass}" var="classes" itemLabel="#{classes.className}" itemValue="#{classes.classId}"/>
                    <p:ajax event="change" update="secc"/>
                  </p:selectOneMenu>
                  <p:message for="clas"/>

                  <p:outputLabel id="dd" value="Section Name :" />
                  <p:selectOneMenu id="secc" value="#{newStudentBean.sectionId}" required="true" requiredMessage="Please select section" style="width: 145px">
                    <f:selectItem itemLabel="Select" itemValue=""/>
                    <f:selectItems value="#{newStudentBean.allSection}" var="section" itemLabel="#{section.sectionName}" itemValue="#{section.sectionId}"/>                           
                  </p:selectOneMenu>
                  <p:message for="secc"/>

                  <p:outputLabel value="Group Name :" />
                  <p:selectOneMenu id="grp" value="#{newStudentBean.groupId}" required="true" requiredMessage="Please select group" style="width: 145px">
                    <f:selectItem itemLabel="Select" itemValue=""/>
                    <f:selectItems value="#{newStudentBean.allGroup}" var="group" itemLabel="#{group.groupName}" itemValue="#{group.groupId}"/>                           
                  </p:selectOneMenu>
                  <p:message for="grp"/>

                  <p:outputLabel value="Student Roll :"/>
                  <p:inputText value="#{newStudentBean.studentRollNo}" id="roll" required="true" requiredMessage="please enter your Roll Number"/>
                  <p:message for="roll"/>
                </h:panelGrid>
              </p:fieldset>
              <br/>
              <p:fieldset legend="Others Information">
                <h:panelGrid columns="3" columnClasses="firstcolumn,centercolumn,thirdcolumn" cellpadding="7" style="margin: 0 auto;">

                  <p:outputLabel value="Registration Date :"/>
                  <p:calendar id="regd"  value="#{newStudentBean.registrationDate}" pattern="dd/MM/yyyy"  required="true" requiredMessage="Please enter Reg Date"/>
                  <p:message for="regd"/>

                  <p:outputLabel value="Registation Fee :"/>
                  <p:inputText id="regfee" value="#{newStudentBean.feeAmount}" required="true" requiredMessage="Please enter Fee Amount"/>
                  <p:message for="regfee"/>

                  <p:outputLabel value="Pay Date :"/>
                  <p:calendar id="payd"  value="#{newStudentBean.payDate}"  pattern="dd/MM/yyyy"  required="true" requiredMessage="Please enter Pay Date"/>                   
                  <p:message for="payd"/>

                  <p:outputLabel value="User Type :" />
                  <p:selectOneMenu id="ut" value="#{newStudentBean.roleId}" required="true" requiredMessage="Please select Role Name" style="width: 145px">
                    <f:selectItem itemLabel="Select" itemValue=""/>
                    <f:selectItems value="#{newStudentBean.allUserType}" var="utype" itemLabel="#{utype.roleName}" itemValue="#{utype.roleId}"/>                           
                  </p:selectOneMenu>
                  <p:message for="ut"/>

                  <p:outputLabel value="User Name :"/>
                  <p:inputText id="unn" value="#{newStudentBean.userName}" required="true" requiredMessage="please enter User Name" style="color: palevioletred"/>
                  <p:message for="unn"/>

                  <p:outputLabel value="Password :"/>
                  <p:password id="psss" value="#{newStudentBean.newPassword}" required="true" requiredMessage="please enter password" style="color: peru"/>
                  <p:message for="psss"/>

                  <p:outputLabel value="Confirm Password :"/>
                  <p:password id="cpsss" value="#{newStudentBean.confirmPassword}" required="true" requiredMessage="please enter password" style="color: peru"/>
                  <p:message for="cpsss"/>

                </h:panelGrid>
              </p:fieldset> -->
						<h:panelGrid columns="1" style="margin: 0 auto;">
							<p:commandButton value="Guardar"
								action="#{newStudentBean.doInsert()}" update="all,g"
								ajax="false" />
						</h:panelGrid>
					</p:panel>
				</h:form>
			</f:view>
			<ui:include src="/public/popup/contactoPoup.xhtml" />
			<ui:include src="/public/popup/parentDialog.xhtml" />
		</ui:define>
	</ui:composition>
</body>
</html>
